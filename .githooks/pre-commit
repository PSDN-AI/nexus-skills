#!/usr/bin/env bash
# Pre-commit hook: runs shellcheck on staged .sh files
# Install: git config core.hooksPath .githooks

set -euo pipefail

# Get staged .sh files (added, copied, modified, renamed)
staged_files=$(git diff --cached --name-only --diff-filter=ACMR -- '*.sh' || true)

if [ -z "$staged_files" ]; then
    exit 0
fi

if ! command -v shellcheck &>/dev/null; then
    echo "WARNING: shellcheck not installed, skipping pre-commit check"
    echo "Install: brew install shellcheck (macOS) or apt install shellcheck (Linux)"
    exit 0
fi

errors=0
for file in $staged_files; do
    if [ -f "$file" ]; then
        if ! shellcheck "$file"; then
            errors=1
        fi
    fi
done

if [ "$errors" -ne 0 ]; then
    echo ""
    echo "shellcheck found issues. Fix them before committing."
    echo "To skip this check: git commit --no-verify"
    exit 1
fi
